/*  Firebase Messaging Service Worker (siguiendo convenciÃ³n Firebase)
    Este SW se enfoca SOLO en push notifications
    El ServiceWorker.js principal maneja cache y otras funciones PWA
*/

importScripts('https://www.gstatic.com/firebasejs/10.12.1/firebase-app-compat.js');
importScripts('https://www.gstatic.com/firebasejs/10.12.1/firebase-messaging-compat.js');

// ConfiguraciÃ³n Firebase (misma que ServiceWorker.js)
const firebaseConfig = {
  apiKey: "AIzaSyAojJehdlYbQjfpjaDPCh-59y0rZG-fM34",
  authDomain: "nightdreams-f90b0.firebaseapp.com",
  projectId: "nightdreams-f90b0",
  storageBucket: "nightdreams-f90b0.firebasestorage.app",
  messagingSenderId: "1011859565794",
  appId: "1:1011859565794:web:f9a5faa6ea2a10f47202bb",
  measurementId: "G-NHMYKW05DT"
};

firebase.initializeApp(firebaseConfig);

const messaging = firebase.messaging();

// SOLO manejar notificaciones background (no cache ni otros eventos)
messaging.onBackgroundMessage((payload) => {
  console.log('ðŸ“¨ [Firebase SW] Background message:', payload);
  
  const notificationTitle = payload.notification?.title || payload.data?.title || 'NightDreams';
  const notificationOptions = {
    body: payload.notification?.body || payload.data?.body || 'Nueva notificaciÃ³n',
    icon: '/icon-192.png',
    badge: '/icon-192.png',
    tag: 'nightdreams-firebase-notification',
    requireInteraction: true,
    data: payload.data || {},
    actions: [
      { action: 'open', title: 'Abrir App' },
      { action: 'close', title: 'Cerrar' }
    ]
  };

  console.log('ðŸ”” [Firebase SW] Showing notification:', notificationTitle);
  return self.registration.showNotification(notificationTitle, notificationOptions);
});

console.log('ðŸ”¥ Firebase Messaging SW initialized (dedicated for notifications only)');
