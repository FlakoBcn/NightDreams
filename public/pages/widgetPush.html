<div class="container" style="margin-top:4vh;">
  <h1 class="logo-font mb-4">📢 Notificación Manual</h1>
  <div class="card mb-4">
    <div class="mb-3">
      <label class="form-label">Título</label>
      <input type="text" id="tituloPush" class="form-control" placeholder="Ej: Cambio de precios" />
    </div>
    <div class="mb-3">
      <label class="form-label">Mensaje</label>
      <textarea id="cuerpoPush" rows="3" class="form-control" placeholder="Mensaje para los promotores..."></textarea>
    </div>
    <div class="mb-3">
  <label class="form-label">Tokens de destinatarios</label>
  <textarea id="tokensPush" rows="4" class="form-control" placeholder="Pega aquí uno o más tokens separados por coma o nueva línea"></textarea>
</div>  
    </div>
    
    <button id="btnEnviarPushManual" class="btn btn-primary w-100">
      Enviar Notificación
    </button>
  </div>
  <div class="text-center mt-4">
    <button class="btn btn-outline-secondary" id="cerrarWidgetPushBtn">← Cerrar</button>
  </div>
</div>
<script>
const PUSH_API_ENDPOINT = 'https://us-central1-nightdreams-f90b0.cloudfunctions.net/enviarPushManual';



async function enviarPushManual() {
  const titulo = document.getElementById('tituloPush').value.trim();
  const cuerpo = document.getElementById('cuerpoPush').value.trim();
  const tokensInput = document.getElementById('tokensPush').value.trim();

  const tokens = tokensInput
    .split(/[\n,]+/)
    .map(t => t.trim())
    .filter(t => t.length > 0);

  if (!titulo || !cuerpo || tokens.length === 0) {
    alert('Completa todos los campos y pega al menos un token válido.');
    return;
  }

  try {
    const res = await fetch(PUSH_API_ENDPOINT, {
      method: 'POST',
      body: JSON.stringify({ titulo, cuerpo, tokens })
    });

    if (res.ok) {
      alert('✅ Notificación enviada correctamente');
      document.getElementById('tituloPush').value = '';
      document.getElementById('cuerpoPush').value = '';
      document.getElementById('tokensPush').value = '';
    } else {
      const error = await res.text();
      alert('❌ Error: ' + error);
    }
  } catch (err) {
    alert('❌ Error de conexión');
    console.error(err);
  }
}

document.getElementById('btnEnviarPushManual').onclick = enviarPushManual;

document.getElementById('cerrarWidgetPushBtn').onclick = () => {
  const container = document.getElementById('widgetPushContainer');
  if (container) {
    container.style.display = 'none';
    container.innerHTML = '';
  }
};
</script>
