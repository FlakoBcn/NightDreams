<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel de Widgets - NightDreams</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500&display=swap" rel="stylesheet">
  <style>
    body { background: #f5f6fa; }
    .logo-font {
      font-family: 'Orbitron', sans-serif;
      letter-spacing: 0.1em;
      font-weight: 500;
      text-transform: uppercase;
      color: #23272f;
    }
    .widget-card {
      border-radius: 20px;
      box-shadow: 0 4px 24px #23272f0d;
      background: #fcfcfd;
      padding: 2rem;
      margin-bottom: 2rem;
      border: 1px solid #e5e7eb;
    }
    .widget-list {
      border-radius: 16px;
      background: #fcfcfd;
      box-shadow: 0 2px 12px #23272f0a;
      padding: 1.5rem;
      border: 1px solid #e5e7eb;
    }
    .widget-preview {
      border-radius: 16px;
      background: #f3f4f6;
      box-shadow: 0 2px 8px #23272f0a;
      padding: 1.5rem;
      min-height: 120px;
      border: 1px solid #e5e7eb;
    }
    .form-control {
      border-radius: 12px;
      padding: 12px 16px;
      font-size: 1rem;
      background-color: #f7f7fa;
      border: 1px solid #d1d5db;
      color: #23272f;
      transition: border-color 0.2s;
    }
    .form-control:focus {
      border-color: #a0aec0;
      box-shadow: 0 0 0 2px #a0aec030;
      background: #fff;
    }
    .btn-primary {
      border-radius: 14px;
      font-weight: bold;
      font-size: 1rem;
      padding: 10px 18px;
      background: linear-gradient(90deg, #23272f 0%, #a0aec0 100%);
      border: none;
      color: #fff;
      box-shadow: 0 2px 8px 0 #23272f10;
    }
    .btn-primary:hover {
      background: linear-gradient(90deg, #a0aec0 0%, #23272f 100%);
      color: #fff;
    }
    .widget-title {
      color: #23272f;
      font-weight: 600;
      letter-spacing: 0.04em;
    }
    .small { font-size: 0.97em; color: #6b7280; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container">
      <a class="navbar-brand logo-font" href="index.html">
        <i class="bi bi-puzzle me-2"></i>
        NightDreams Widgets
      </a>
      <button class="btn btn-outline-light btn-sm" onclick="window.location.href='index.html'">
        Volver a App
      </button>
    </div>
  </nav>

  <div class="container" style="max-width: 800px;">
    <div class="widget-card">
      <h2 class="widget-title mb-3">Crear Nuevo Widget</h2>
      <form id="widgetForm" autocomplete="off">
        <div class="mb-3">
          <label class="form-label">Título del Widget</label>
          <input type="text" class="form-control" id="widgetTitle" required maxlength="40">
        </div>
        <div class="mb-3">
          <label class="form-label">Contenido HTML</label>
          <textarea class="form-control" id="widgetContent" rows="4" required placeholder="Puedes usar HTML básico, por ejemplo: &lt;b&gt;Promo!&lt;/b&gt;..."></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Crear Widget</button>
      </form>
    </div>

    <div class="widget-list mb-4">
      <h4 class="widget-title mb-3">Widgets Creados</h4>
      <div id="widgetsList" class="small text-muted">No hay widgets aún.</div>
    </div>

    <div class="widget-preview">
      <h5 class="widget-title mb-2">Vista Previa</h5>
      <div id="widgetPreview" class="small text-muted">Crea o selecciona un widget para previsualizarlo aquí.</div>
    </div>
  </div>

  <script>
    // Simple localStorage-based widget manager (replace with Firestore if needed)
    function getWidgets() {
      return JSON.parse(localStorage.getItem('widgets') || '[]');
    }
    function saveWidgets(widgets) {
      localStorage.setItem('widgets', JSON.stringify(widgets));
    }
    function renderWidgetsList() {
      const widgets = getWidgets();
      const list = document.getElementById('widgetsList');
      if (!widgets.length) {
        list.innerHTML = '<span class="text-muted">No hay widgets aún.</span>';
        return;
      }
      list.innerHTML = widgets.map((w, i) => `
        <div class="d-flex align-items-center justify-content-between mb-2 p-2" style="border-radius:10px;background:#f6f7fb;">
          <div>
            <strong>${w.title}</strong>
            <button class="btn btn-link btn-sm text-primary" onclick="previewWidget(${i})">Ver</button>
          </div>
          <button class="btn btn-outline-danger btn-sm" onclick="deleteWidget(${i})">Eliminar</button>
        </div>
      `).join('');
    }
    function previewWidget(idx) {
      const widgets = getWidgets();
      const w = widgets[idx];
      document.getElementById('widgetPreview').innerHTML = `<div style='font-weight:600;font-size:1.1em;margin-bottom:0.5em;'>${w.title}</div>` + w.content;
    }
    function deleteWidget(idx) {
      if (!confirm('¿Eliminar este widget?')) return;
      const widgets = getWidgets();
      widgets.splice(idx, 1);
      saveWidgets(widgets);
      renderWidgetsList();
      document.getElementById('widgetPreview').innerHTML = '<span class="text-muted">Crea o selecciona un widget para previsualizarlo aquí.</span>';
    }
    document.getElementById('widgetForm').onsubmit = function(e) {
      e.preventDefault();
      const title = document.getElementById('widgetTitle').value.trim();
      const content = document.getElementById('widgetContent').value.trim();
      if (!title || !content) return;
      const widgets = getWidgets();
      widgets.push({ title, content });
      saveWidgets(widgets);
      renderWidgetsList();
      document.getElementById('widgetForm').reset();
      document.getElementById('widgetPreview').innerHTML = '<span class="text-success">Widget creado. Selecciónalo para previsualizar.</span>';
    };
    // Inicializar
    renderWidgetsList();
  </script>
</body>
</html>
